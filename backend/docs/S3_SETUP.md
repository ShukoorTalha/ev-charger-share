# AWS S3 Setup Guide for EV ChargerShare

This guide will help you set up AWS S3 for image storage in the EV ChargerShare application.

## Prerequisites

- AWS Account
- AWS CLI installed (optional but recommended)

## Step 1: Create S3 Bucket

1. Log in to AWS Console
2. Navigate to S3 service
3. Click "Create bucket"
4. Choose a unique bucket name (e.g., `evchargershare-images-yourname`)
5. Select your preferred region
6. **Important**: Keep "Block all public access" checked (default) for security
7. Create the bucket

## Step 2: Configure Bucket for Private Access

**Important**: Keep the bucket private (do NOT add public read policies). The application uses signed URLs for secure image access.

- Ensure "Block all public access" is **checked** (default)
- Do not add any bucket policies for public access
- Images will be accessed via signed URLs generated by the application

## Step 3: Create IAM User

1. Navigate to IAM service in AWS Console
2. Click "Users" â†’ "Add user"
3. Choose a username (e.g., `evchargershare-s3-user`)
4. Select "Programmatic access"
5. Attach the following policy:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::YOUR_BUCKET_NAME",
                "arn:aws:s3:::YOUR_BUCKET_NAME/*"
            ]
        }
    ]
}
```

6. Save the Access Key ID and Secret Access Key

## Step 4: Configure Environment Variables

Create or update your `.env` file with:

```bash
# AWS S3 Configuration
AWS_ACCESS_KEY_ID=your_access_key_id_here
AWS_SECRET_ACCESS_KEY=your_secret_access_key_here
AWS_REGION=us-east-1
S3_BUCKET_NAME=your_bucket_name_here
```

## Step 5: Test Configuration

The application includes a configuration check. Start your server and look for:

```
S3 bucket your-bucket-name is accessible
```

If you see an error, check your credentials and bucket permissions.

## Security Best Practices

1. **Never commit AWS credentials to version control**
2. Use IAM roles in production environments when possible
3. Regularly rotate access keys
4. Monitor S3 access logs
5. Consider using CloudFront CDN for better performance

## Troubleshooting

### Common Issues:

1. **Access Denied**: Check bucket policy and IAM permissions
2. **Bucket not found**: Verify bucket name and region
3. **Invalid credentials**: Double-check access keys in .env file

### Testing S3 Connection:

You can test the S3 connection by creating a simple test endpoint:

```javascript
// Add to your routes for testing
app.get('/test-s3', async (req, res) => {
  const { checkS3Configuration } = require('./utils/s3Upload');
  const isConfigured = await checkS3Configuration();
  res.json({ s3Configured: isConfigured });
});
```

## Cost Considerations

- S3 storage costs are minimal for image files
- Consider setting up lifecycle policies to archive old images
- Monitor usage through AWS Cost Explorer
- Use S3 Intelligent Tiering for automatic cost optimization

## Production Recommendations

1. Use CloudFront CDN for global image delivery
2. Enable S3 versioning for backup
3. Set up S3 Cross-Region Replication for disaster recovery
4. Use AWS KMS for encryption at rest
5. Implement proper monitoring and alerting
